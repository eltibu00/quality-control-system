<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QC Dashboard - Quality Control System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2d3748;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            color: #718096;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2d3748;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th {
            background: #f7fafc;
            padding: 15px;
            text-align: left;
            color: #2d3748;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        /* Photo Upload */
        .photo-upload {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f7fafc;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .photo-upload.required {
            border-color: #f56565;
        }

        .photo-preview {
            max-width: 300px;
            max-height: 300px;
            margin: 20px auto;
            border-radius: 8px;
            display: none;
        }

        .photo-preview.visible {
            display: block;
        }

        /* Inspector Badge */
        .inspector-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }

        .inspector-available {
            background: #c6f6d5;
            color: #22543d;
        }

        .inspector-busy {
            background: #fed7d7;
            color: #c53030;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: #feebc8;
            color: #7c2d12;
        }

        .status-progress {
            background: #bee3f8;
            color: #2c5282;
        }

        .status-completed {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-pass {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-fail {
            background: #fed7d7;
            color: #c53030;
        }

        .status-rework {
            background: #feebc8;
            color: #7c2d12;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .message-error {
            background: #fed7d7;
            color: #c53030;
            border-left: 4px solid #f56565;
        }

        .message-success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }

        .message-info {
            background: #bee3f8;
            color: #2c5282;
            border-left: 4px solid #4299e1;
        }

        /* Type-Specific Sections */
        .inspection-section {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .inspection-section.visible {
            display: block;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 22px;
            }

            .tab {
                padding: 12px 20px;
                font-size: 14px;
            }
        }

        /* Hide by default */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>‚úì QC Dashboard - Quality Control System</h1>
            <p>Track inspections, ensure quality, maintain compliance</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="switchTab('queue')">üìã Inspection Queue</button>
            <button class="tab" onclick="switchTab('create')">‚ûï Create Inspection</button>
            <button class="tab" onclick="switchTab('complete')">‚úÖ Complete Inspection</button>
            <button class="tab" onclick="switchTab('archive')">üóÑÔ∏è Archive</button>
        </div>

        <!-- Tab 1: Dashboard Overview -->
        <div id="dashboard" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: #2d3748;">üìä Today's QC Performance</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Inspected Today</div>
                    <div class="stat-value" id="total-inspected">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Pass Rate</div>
                    <div class="stat-value" id="pass-rate">-%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">In Progress</div>
                    <div class="stat-value" id="in-progress">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">In Queue</div>
                    <div class="stat-value" id="in-queue">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Passed</div>
                    <div class="stat-value" id="total-passed">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Failed</div>
                    <div class="stat-value" id="total-failed">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Time</div>
                    <div class="stat-value" id="avg-time">- min</div>
                </div>
            </div>

            <h3 style="margin: 30px 0 15px; color: #2d3748;">By Inspection Type</h3>
            <table class="data-table" id="type-breakdown">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Total</th>
                        <th>Pass</th>
                        <th>Fail</th>
                        <th>Pass %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" class="loading">
                            <div class="spinner"></div>
                            Loading dashboard data...
                        </td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin: 30px 0 15px; color: #2d3748;">Inspector Performance</h3>
            <table class="data-table" id="inspector-performance">
                <thead>
                    <tr>
                        <th>Inspector</th>
                        <th>Status</th>
                        <th>Today</th>
                        <th>Pass</th>
                        <th>Pass %</th>
                        <th>Avg Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" class="loading">Loading...</td>
                    </tr>
                </tbody>
            </table>

            <button onclick="loadDashboard()" style="margin-top: 20px;" class="btn">üîÑ Refresh Dashboard</button>
        </div>

        <!-- Tab 2: Inspection Queue -->
        <div id="queue" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">üìã Inspection Queue</h2>
            
            <div style="margin-bottom: 20px;">
                <label>Filter by Type:</label>
                <select id="queue-filter" onchange="filterQueue()" style="padding: 10px; border-radius: 8px; border: 2px solid #e2e8f0; margin-left: 10px;">
                    <option value="">All Types</option>
                    <option value="Inbound">Inbound</option>
                    <option value="Outbound">Outbound</option>
                    <option value="Random Audit">Random Audit</option>
                    <option value="BOL Check">BOL Check</option>
                    <option value="Packed Carton">Packed Carton</option>
                    <option value="Production QC">Production QC</option>
                </select>
            </div>

            <table class="data-table" id="queue-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Order/WO</th>
                        <th>Client</th>
                        <th>Priority</th>
                        <th>Inspector</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="7" class="loading">
                            <div class="spinner"></div>
                            Loading queue...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tab 3: Create Inspection -->
        <div id="create" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">‚ûï Create New Inspection</h2>
            
            <div class="form-group">
                <label>Inspection Type *</label>
                <select id="inspection-type" onchange="showInspectionForm()">
                    <option value="">Select inspection type...</option>
                    <option value="Inbound">üì¶ Inbound QC (5% sampling)</option>
                    <option value="Outbound">üì§ Outbound QC</option>
                    <option value="Random Audit">üé≤ Random Audit</option>
                    <option value="BOL Check">üìã BOL Check (Photo Required)</option>
                    <option value="Packed Carton">üì¶ Packed Carton QC</option>
                    <option value="Production QC">üè≠ Production QC (5% sampling)</option>
                </select>
            </div>

            <!-- Common Fields -->
            <div id="common-fields" class="inspection-section">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Inspector *</label>
                        <select id="inspector">
                            <option value="">Select inspector...</option>
                            <option value="John">John</option>
                            <option value="Maria">Maria</option>
                            <option value="Roberto">Roberto</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Priority</label>
                        <select id="priority">
                            <option value="Normal">Normal</option>
                            <option value="High">High</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Inbound QC Form -->
            <div id="inbound-form" class="inspection-section">
                <h3 style="color: #2d3748; margin-bottom: 15px;">üì¶ Inbound Inspection Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>PO Number *</label>
                        <input type="text" id="inbound-po" placeholder="PO-12345">
                    </div>
                    <div class="form-group">
                        <label>Client *</label>
                        <select id="inbound-client">
                            <option value="">Select client...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Total Pallets Received *</label>
                        <input type="number" id="inbound-total-pallets" placeholder="20" oninput="calculateInboundSample()">
                    </div>
                    <div class="form-group">
                        <label>Pallets to Inspect (5%)</label>
                        <input type="number" id="inbound-sample-pallets" readonly style="background: #f7fafc;">
                    </div>
                    <div class="form-group">
                        <label>Pallet IDs Inspected</label>
                        <input type="text" id="inbound-pallet-ids" placeholder="A-045, A-046">
                    </div>
                </div>
                <div class="form-group">
                    <label>Other Notes</label>
                    <textarea id="inbound-notes" placeholder="Any additional observations..."></textarea>
                </div>
            </div>

            <!-- Outbound QC Form -->
            <div id="outbound-form" class="inspection-section">
                <h3 style="color: #2d3748; margin-bottom: 15px;">üì§ Outbound Inspection Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Order Number *</label>
                        <input type="text" id="outbound-order" placeholder="886221">
                    </div>
                    <div class="form-group">
                        <label>Client *</label>
                        <select id="outbound-client">
                            <option value="">Select client...</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Other Notes</label>
                    <textarea id="outbound-notes" placeholder="Customer requests, rush order notes, etc..."></textarea>
                </div>
            </div>

            <!-- Random Audit Form -->
            <div id="audit-form" class="inspection-section">
                <h3 style="color: #2d3748; margin-bottom: 15px;">üé≤ Random Audit Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Audit Type *</label>
                        <select id="audit-type">
                            <option value="">Select type...</option>
                            <option value="Putaway">Putaway Audit</option>
                            <option value="Replenishment">Replenishment Audit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Locations to Check</label>
                        <input type="number" id="audit-locations" placeholder="10" value="10">
                    </div>
                    <div class="form-group">
                        <label>Location IDs</label>
                        <input type="text" id="audit-location-ids" placeholder="A5-B12, A5-B15, A6-C03...">
                    </div>
                </div>
                <div class="form-group">
                    <label>Other Notes</label>
                    <textarea id="audit-notes" placeholder="Training needs, systemic issues, etc..."></textarea>
                </div>
            </div>

            <!-- BOL Check Form -->
            <div id="bol-form" class="inspection-section">
                <h3 style="color: #2d3748; margin-bottom: 15px;">üìã BOL Check Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>BOL Number *</label>
                        <input type="text" id="bol-number" placeholder="BOL-556789">
                    </div>
                    <div class="form-group">
                        <label>Client *</label>
                        <select id="bol-client">
                            <option value="">Select client...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Orders on BOL *</label>
                        <input type="text" id="bol-orders" placeholder="886221, 886222, 886223">
                    </div>
                    <div class="form-group">
                        <label>Carrier</label>
                        <input type="text" id="bol-carrier" placeholder="FedEx Freight">
                    </div>
                    <div class="form-group">
                        <label>Truck Number</label>
                        <input type="text" id="bol-truck" placeholder="T-4567">
                    </div>
                    <div class="form-group">
                        <label>Driver Name</label>
                        <input type="text" id="bol-driver" placeholder="John Smith">
                    </div>
                    <div class="form-group">
                        <label>Pallet Count</label>
                        <input type="number" id="bol-pallets" placeholder="12">
                    </div>
                    <div class="form-group">
                        <label>Seal Number</label>
                        <input type="text" id="bol-seal" placeholder="445678">
                    </div>
                    <div class="form-group">
                        <label>Signature Obtained</label>
                        <select id="bol-signature">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Other Notes</label>
                    <textarea id="bol-notes" placeholder="Truck delays, weather conditions, special instructions..."></textarea>
                </div>
            </div>

            <!-- Packed Carton Form -->
            <div id="packed-form" class="inspection-section">
                <h3 style="color: #2d3748; margin-bottom: 15px;">üì¶ Packed Carton Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Order Number *</label>
                        <input type="text" id="packed-order" placeholder="886226">
                    </div>
                    <div class="form-group">
                        <label>Client *</label>
                        <select id="packed-client">
                            <option value="">Select client...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Total Cartons</label>
                        <input type="number" id="packed-total-cartons" placeholder="3">
                    </div>
                    <div class="form-group">
                        <label>Carton Inspected</label>
                        <input type="text" id="packed-carton-num" placeholder="Carton 2 of 3">
                    </div>
                    <div class="form-group">
                        <label>Labels Required?</label>
                        <select id="packed-labels-required">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Labels Present?</label>
                        <select id="packed-labels-present">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Other Notes</label>
                    <textarea id="packed-notes" placeholder="Special packing requirements, customer SOPs..."></textarea>
                </div>
            </div>

            <!-- Production QC Form -->
            <div id="production-form" class="inspection-section">
                <h3 style="color: #2d3748; margin-bottom: 15px;">üè≠ Production QC Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Work Order Number *</label>
                        <input type="text" id="production-wo" placeholder="WO-789">
                    </div>
                    <div class="form-group">
                        <label>Client *</label>
                        <select id="production-client" onchange="loadClientSpecs()">
                            <option value="">Select client...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>VAS Type</label>
                        <select id="production-vas">
                            <option value="Kitting">Kitting</option>
                            <option value="Labeling">Labeling</option>
                            <option value="Assembly">Assembly</option>
                            <option value="Rework">Rework</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Units Produced *</label>
                        <input type="number" id="production-units" placeholder="100" oninput="calculateProductionSample()">
                    </div>
                    <div class="form-group">
                        <label>Sample Size (5%)</label>
                        <input type="number" id="production-sample" readonly style="background: #f7fafc;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Other Notes</label>
                    <textarea id="production-notes" placeholder="Equipment issues, process notes, quality trends..."></textarea>
                </div>
            </div>

            <div id="create-message"></div>

            <button onclick="createInspection()" class="btn" style="margin-top: 20px;">‚ûï Create Inspection</button>
        </div>

        <!-- Tab 4: Complete Inspection -->
        <div id="complete" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">‚úÖ Complete Inspection</h2>
            
            <div class="form-group">
                <label>Select Inspection from Queue *</label>
                <select id="complete-inspection-id" onchange="loadInspectionDetails()">
                    <option value="">Select inspection to complete...</option>
                </select>
            </div>

            <div id="inspection-details" class="inspection-section">
                <h3 style="color: #2d3748; margin-bottom: 15px;">Inspection Information</h3>
                <div id="inspection-info"></div>

                <h3 style="color: #2d3748; margin: 20px 0 15px;">Inspection Result *</h3>
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <button onclick="setResult('Pass')" class="btn btn-success" id="result-pass">‚úì Pass</button>
                    <button onclick="setResult('Fail')" class="btn btn-danger" id="result-fail">‚úó Fail</button>
                    <button onclick="setResult('Rework')" class="btn btn-warning" id="result-rework">‚ö† Rework</button>
                </div>

                <div id="defect-section" class="hidden" style="margin-bottom: 20px;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">Log Defects</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Defect Type</label>
                            <select id="defect-type">
                                <option value="">Select defect...</option>
                                <option value="Damaged Packaging">Damaged Packaging</option>
                                <option value="Wrong Item">Wrong Item</option>
                                <option value="Missing Items">Missing Items</option>
                                <option value="Quality Issues">Quality Issues</option>
                                <option value="Labeling Errors">Labeling Errors</option>
                                <option value="Wrong Quantity">Wrong Quantity</option>
                                <option value="Signature Issues">Signature Issues</option>
                                <option value="Production Defects">Production Defects</option>
                                <option value="Location Error">Location Error</option>
                                <option value="System Issue">System Issue</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Severity</label>
                            <select id="defect-severity">
                                <option value="Minor">Minor</option>
                                <option value="Major">Major</option>
                                <option value="Critical">Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Quantity Affected</label>
                            <input type="number" id="defect-quantity" value="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Defect Description</label>
                        <textarea id="defect-description" placeholder="Describe the defect..."></textarea>
                    </div>
                    <button onclick="addDefect()" class="btn-secondary btn">‚ûï Add Defect</button>
                    
                    <div id="defects-list" style="margin-top: 15px;"></div>
                </div>

                <!-- BOL Photo Upload Section -->
                <div id="bol-photo-section" class="hidden">
                    <h3 style="color: #2d3748; margin: 20px 0 15px;">üì∏ BOL Photo (Required) *</h3>
                    <div class="photo-upload required" onclick="document.getElementById('photo-input').click()">
                        <p style="font-size: 48px; margin-bottom: 10px;">üì∑</p>
                        <p style="font-weight: 600;">Click to take photo or upload</p>
                        <p style="font-size: 12px; color: #718096; margin-top: 5px;">Accepted: JPG, PNG, PDF (Max 10MB)</p>
                    </div>
                    <input type="file" id="photo-input" accept="image/*,application/pdf" capture="environment" style="display: none;" onchange="handlePhotoUpload(event)">
                    <img id="photo-preview" class="photo-preview">
                    <div id="photo-status"></div>
                </div>

                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="complete-notes" placeholder="Any final observations or notes..."></textarea>
                </div>

                <div id="complete-message"></div>

                <button onclick="completeInspection()" class="btn" style="margin-top: 20px;">‚úÖ Complete Inspection</button>
            </div>
        </div>

        <!-- Tab 5: Archive -->
        <div id="archive" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">üóÑÔ∏è Inspection Archive</h2>
            
            <div class="form-grid" style="margin-bottom: 20px;">
                <div class="form-group">
                    <label>Search</label>
                    <input type="text" id="archive-search" placeholder="Order number, client, etc...">
                </div>
                <div class="form-group">
                    <label>Filter by Type</label>
                    <select id="archive-type">
                        <option value="">All Types</option>
                        <option value="Inbound">Inbound</option>
                        <option value="Outbound">Outbound</option>
                        <option value="Random Audit">Random Audit</option>
                        <option value="BOL Check">BOL Check</option>
                        <option value="Packed Carton">Packed Carton</option>
                        <option value="Production QC">Production QC</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Filter by Client</label>
                    <select id="archive-client">
                        <option value="">All Clients</option>
                    </select>
                </div>
            </div>

            <button onclick="searchArchive()" class="btn">üîç Search Archive</button>
            <button onclick="archiveCompleted()" class="btn-secondary btn" style="margin-left: 10px;">üóÑÔ∏è Archive Completed Now</button>

            <table class="data-table" id="archive-table" style="margin-top: 20px;">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Order/WO</th>
                        <th>Client</th>
                        <th>Inspector</th>
                        <th>Result</th>
                        <th>Duration</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #718096;">
                            Use search filters above to find archived inspections
                        </td>
                    </tr>
                </tbody>
            </table>

            <div id="archive-message"></div>
        </div>
    </div>

    <script>
        // Configuration - UPDATE WITH YOUR APPS SCRIPT URL
        const SHEET_URL = 'https://script.google.com/macros/s/AKfycbx3cCtUO5MjfntlZ62bpl_t7mBlnyvAZqS_wP1eRU6xMo1HkoUUO71HlRvPcmh4EFBS/exec';
        
        // Global state
        let currentInspectionId = null;
        let inspectionResult = null;
        let defects = [];
        let photoUploaded = false;

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data when switching tabs
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'queue') {
                loadQueue();
            } else if (tabName === 'create') {
                loadClients();
            } else if (tabName === 'complete') {
                loadInspectionsForCompletion();
            }
        }

        // Load dashboard metrics
        async function loadDashboard() {
            try {
                const response = await fetch(SHEET_URL + '?action=getDashboard');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                // Update stats
                document.getElementById('total-inspected').textContent = data.totals.inspectedToday;
                document.getElementById('pass-rate').textContent = data.totals.passRate + '%';
                document.getElementById('in-progress').textContent = data.totals.inProgress;
                document.getElementById('in-queue').textContent = data.totals.inQueue;
                document.getElementById('total-passed').textContent = data.totals.passed;
                document.getElementById('total-failed').textContent = data.totals.failed;
                document.getElementById('avg-time').textContent = data.totals.avgTime + ' min';

                // Update type breakdown
                const typeBody = document.querySelector('#type-breakdown tbody');
                typeBody.innerHTML = '';
                data.byType.forEach(type => {
                    const row = typeBody.insertRow();
                    row.innerHTML = `
                        <td><strong>${type.type}</strong></td>
                        <td>${type.total}</td>
                        <td>${type.pass}</td>
                        <td>${type.fail}</td>
                        <td>${type.passRate.toFixed(1)}%</td>
                    `;
                });

                // Update inspector performance
                const inspBody = document.querySelector('#inspector-performance tbody');
                inspBody.innerHTML = '';
                data.inspectors.forEach(insp => {
                    const row = inspBody.insertRow();
                    const statusBadge = insp.inProgress > 0 ? 
                        '<span class="inspector-badge inspector-busy">üî¥ Busy</span>' :
                        '<span class="inspector-badge inspector-available">üü¢ Available</span>';
                    row.innerHTML = `
                        <td><strong>${insp.name}</strong></td>
                        <td>${statusBadge}</td>
                        <td>${insp.total}</td>
                        <td>${insp.pass}</td>
                        <td>${insp.passRate.toFixed(1)}%</td>
                        <td>${insp.avgTime.toFixed(1)} min</td>
                    `;
                });

            } catch (error) {
                console.error('Error loading dashboard:', error);
                showMessage('dashboard', 'Error loading dashboard data', 'error');
            }
        }

        // Load inspection queue
        async function loadQueue() {
            try {
                const response = await fetch(SHEET_URL + '?action=getQueue');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                const tbody = document.querySelector('#queue-table tbody');
                tbody.innerHTML = '';

                if (data.queue.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #718096;">No inspections in queue</td></tr>';
                    return;
                }

                data.queue.forEach(inspection => {
                    const row = tbody.insertRow();
                    const statusClass = inspection.status === 'Pending' ? 'status-pending' : 'status-progress';
                    row.innerHTML = `
                        <td>${inspection.type}</td>
                        <td>${inspection.orderNumber}</td>
                        <td>${inspection.client}</td>
                        <td>${inspection.priority}</td>
                        <td>${inspection.inspector || 'Unassigned'}</td>
                        <td><span class="status-badge ${statusClass}">${inspection.status}</span></td>
                        <td>
                            ${inspection.status === 'Pending' ? 
                                `<button class="btn-secondary btn" style="padding: 8px 15px; font-size: 12px;" onclick="startInspection('${inspection.id}')">‚ñ∂ Start</button>` :
                                `<button class="btn-secondary btn" style="padding: 8px 15px; font-size: 12px;" onclick="viewInspection('${inspection.id}')">üëÅ View</button>`
                            }
                        </td>
                    `;
                });

            } catch (error) {
                console.error('Error loading queue:', error);
                showMessage('queue', 'Error loading inspection queue', 'error');
            }
        }

        // Load clients for dropdowns
        async function loadClients() {
            try {
                const response = await fetch(SHEET_URL + '?action=getClients');
                const data = await response.json();
                
                const selects = [
                    'inbound-client', 'outbound-client', 'bol-client',
                    'packed-client', 'production-client', 'archive-client'
                ];

                selects.forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        select.innerHTML = '<option value="">Select client...</option>';
                        data.clients.forEach(client => {
                            const option = document.createElement('option');
                            option.value = client;
                            option.textContent = client;
                            select.appendChild(option);
                        });
                    }
                });

            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }

        // Show inspection form based on type
        function showInspectionForm() {
            const type = document.getElementById('inspection-type').value;
            
            // Hide all forms
            document.querySelectorAll('.inspection-section').forEach(section => {
                section.classList.remove('visible');
            });

            // Show common fields
            if (type) {
                document.getElementById('common-fields').classList.add('visible');

                // Show type-specific form
                const formMap = {
                    'Inbound': 'inbound-form',
                    'Outbound': 'outbound-form',
                    'Random Audit': 'audit-form',
                    'BOL Check': 'bol-form',
                    'Packed Carton': 'packed-form',
                    'Production QC': 'production-form'
                };

                const formId = formMap[type];
                if (formId) {
                    document.getElementById(formId).classList.add('visible');
                }
            }
        }

        // Calculate 5% sample for inbound
        function calculateInboundSample() {
            const total = parseInt(document.getElementById('inbound-total-pallets').value) || 0;
            const sample = Math.max(1, Math.ceil(total * 0.05));
            document.getElementById('inbound-sample-pallets').value = sample;
        }

        // Calculate 5% sample for production
        function calculateProductionSample() {
            const total = parseInt(document.getElementById('production-units').value) || 0;
            const sample = Math.max(1, Math.ceil(total * 0.05));
            document.getElementById('production-sample').value = sample;
        }

        // Create inspection
        async function createInspection() {
            const type = document.getElementById('inspection-type').value;
            if (!type) {
                showMessage('create', 'Please select inspection type', 'error');
                return;
            }

            const inspector = document.getElementById('inspector').value;
            if (!inspector) {
                showMessage('create', 'Please select inspector', 'error');
                return;
            }

            const data = {
                type: type,
                inspector: inspector,
                priority: document.getElementById('priority').value
            };

            // Collect type-specific data
            switch(type) {
                case 'Inbound':
                    data.orderNumber = document.getElementById('inbound-po').value;
                    data.client = document.getElementById('inbound-client').value;
                    data.totalPallets = document.getElementById('inbound-total-pallets').value;
                    data.palletsToInspect = document.getElementById('inbound-sample-pallets').value;
                    data.palletIds = document.getElementById('inbound-pallet-ids').value;
                    data.otherNotes = document.getElementById('inbound-notes').value;
                    break;
                case 'Outbound':
                    data.orderNumber = document.getElementById('outbound-order').value;
                    data.client = document.getElementById('outbound-client').value;
                    data.otherNotes = document.getElementById('outbound-notes').value;
                    break;
                case 'Random Audit':
                    data.auditType = document.getElementById('audit-type').value;
                    data.locationsChecked = document.getElementById('audit-locations').value;
                    data.locationIds = document.getElementById('audit-location-ids').value;
                    data.otherNotes = document.getElementById('audit-notes').value;
                    break;
                case 'BOL Check':
                    data.bolNumber = document.getElementById('bol-number').value;
                    data.client = document.getElementById('bol-client').value;
                    data.orders = document.getElementById('bol-orders').value;
                    data.carrier = document.getElementById('bol-carrier').value;
                    data.truckNumber = document.getElementById('bol-truck').value;
                    data.driverName = document.getElementById('bol-driver').value;
                    data.palletCount = document.getElementById('bol-pallets').value;
                    data.sealNumber = document.getElementById('bol-seal').value;
                    data.signatureObtained = document.getElementById('bol-signature').value;
                    data.orderNumber = data.bolNumber;
                    data.otherNotes = document.getElementById('bol-notes').value;
                    break;
                case 'Packed Carton':
                    data.orderNumber = document.getElementById('packed-order').value;
                    data.client = document.getElementById('packed-client').value;
                    data.totalCartons = document.getElementById('packed-total-cartons').value;
                    data.cartonInspected = document.getElementById('packed-carton-num').value;
                    data.labelsRequired = document.getElementById('packed-labels-required').value;
                    data.labelsPresent = document.getElementById('packed-labels-present').value;
                    data.otherNotes = document.getElementById('packed-notes').value;
                    break;
                case 'Production QC':
                    data.workOrder = document.getElementById('production-wo').value;
                    data.orderNumber = data.workOrder;
                    data.client = document.getElementById('production-client').value;
                    data.vasType = document.getElementById('production-vas').value;
                    data.unitsProduced = document.getElementById('production-units').value;
                    data.sampleSize = document.getElementById('production-sample').value;
                    data.otherNotes = document.getElementById('production-notes').value;
                    break;
            }

            try {
                const response = await fetch(SHEET_URL + '?action=createInspection', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (result.error) {
                    throw new Error(result.error);
                }

                showMessage('create', '‚úÖ Inspection created successfully! ID: ' + result.inspectionId, 'success');
                
                // Reset form after 2 seconds
                setTimeout(() => {
                    document.getElementById('inspection-type').value = '';
                    showInspectionForm();
                }, 2000);

            } catch (error) {
                console.error('Error creating inspection:', error);
                showMessage('create', 'Error creating inspection: ' + error.message, 'error');
            }
        }

        // Start inspection
        async function startInspection(inspectionId) {
            try {
                const response = await fetch(SHEET_URL + '?action=startInspection', {
                    method: 'POST',
                    body: JSON.stringify({ inspectionId: inspectionId })
                });
                const result = await response.json();

                if (result.error) {
                    throw new Error(result.error);
                }

                alert('‚úÖ Inspection started! Timer is running.');
                loadQueue();

            } catch (error) {
                console.error('Error starting inspection:', error);
                alert('Error starting inspection: ' + error.message);
            }
        }

        // Load inspections for completion
        async function loadInspectionsForCompletion() {
            try {
                const response = await fetch(SHEET_URL + '?action=getQueue');
                const data = await response.json();

                const select = document.getElementById('complete-inspection-id');
                select.innerHTML = '<option value="">Select inspection to complete...</option>';

                data.queue.forEach(inspection => {
                    if (inspection.status === 'In Progress') {
                        const option = document.createElement('option');
                        option.value = inspection.id;
                        option.textContent = `${inspection.type} - ${inspection.orderNumber} (${inspection.client})`;
                        select.appendChild(option);
                    }
                });

            } catch (error) {
                console.error('Error loading inspections:', error);
            }
        }

        // Load inspection details for completion
        async function loadInspectionDetails() {
            const inspectionId = document.getElementById('complete-inspection-id').value;
            if (!inspectionId) {
                document.getElementById('inspection-details').classList.remove('visible');
                return;
            }

            currentInspectionId = inspectionId;
            document.getElementById('inspection-details').classList.add('visible');

            try {
                const response = await fetch(SHEET_URL + '?action=getInspection&id=' + inspectionId);
                const data = await response.json();

                document.getElementById('inspection-info').innerHTML = `
                    <p><strong>Type:</strong> ${data.type}</p>
                    <p><strong>Order/WO:</strong> ${data.orderNumber}</p>
                    <p><strong>Client:</strong> ${data.client}</p>
                    <p><strong>Inspector:</strong> ${data.inspector}</p>
                    <p><strong>Started:</strong> ${data.startTime}</p>
                `;

                // Show BOL photo section if BOL Check
                if (data.type === 'BOL Check') {
                    document.getElementById('bol-photo-section').classList.remove('hidden');
                } else {
                    document.getElementById('bol-photo-section').classList.add('hidden');
                }

            } catch (error) {
                console.error('Error loading inspection:', error);
            }
        }

        // Set inspection result
        function setResult(result) {
            inspectionResult = result;
            
            // Update button styles
            document.querySelectorAll('[id^="result-"]').forEach(btn => {
                btn.style.opacity = '0.5';
            });
            document.getElementById('result-' + result.toLowerCase()).style.opacity = '1';

            // Show defect section if fail or rework
            if (result === 'Fail' || result === 'Rework') {
                document.getElementById('defect-section').classList.remove('hidden');
            } else {
                document.getElementById('defect-section').classList.add('hidden');
            }
        }

        // Add defect
        function addDefect() {
            const type = document.getElementById('defect-type').value;
            if (!type) {
                alert('Please select defect type');
                return;
            }

            const defect = {
                type: type,
                severity: document.getElementById('defect-severity').value,
                quantity: document.getElementById('defect-quantity').value,
                description: document.getElementById('defect-description').value
            };

            defects.push(defect);

            // Update list
            const list = document.getElementById('defects-list');
            const item = document.createElement('div');
            item.className = 'message message-error';
            item.style.marginBottom = '10px';
            item.innerHTML = `
                <strong>${defect.type}</strong> (${defect.severity}) - Qty: ${defect.quantity}<br>
                ${defect.description}
                <button onclick="removeDefect(${defects.length - 1})" style="float: right; background: none; border: none; color: #c53030; cursor: pointer;">‚úï</button>
            `;
            list.appendChild(item);

            // Clear form
            document.getElementById('defect-type').value = '';
            document.getElementById('defect-description').value = '';
        }

        // Remove defect
        function removeDefect(index) {
            defects.splice(index, 1);
            // Rebuild list
            const list = document.getElementById('defects-list');
            list.innerHTML = '';
            defects.forEach((defect, i) => {
                const item = document.createElement('div');
                item.className = 'message message-error';
                item.style.marginBottom = '10px';
                item.innerHTML = `
                    <strong>${defect.type}</strong> (${defect.severity}) - Qty: ${defect.quantity}<br>
                    ${defect.description}
                    <button onclick="removeDefect(${i})" style="float: right; background: none; border: none; color: #c53030; cursor: pointer;">‚úï</button>
                `;
                list.appendChild(item);
            });
        }

        // Handle photo upload
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 10 * 1024 * 1024) {
                alert('File too large! Maximum size is 10MB.');
                return;
            }

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('photo-preview');
                preview.src = e.target.result;
                preview.classList.add('visible');
                photoUploaded = true;
                document.getElementById('photo-status').innerHTML = '<div class="message message-success">‚úÖ Photo ready to upload</div>';
            };
            reader.readAsDataURL(file);
        }

        // Complete inspection
        async function completeInspection() {
            if (!currentInspectionId) {
                showMessage('complete', 'Please select an inspection', 'error');
                return;
            }

            if (!inspectionResult) {
                showMessage('complete', 'Please select Pass, Fail, or Rework', 'error');
                return;
            }

            // Check BOL photo requirement
            const isBOL = document.getElementById('bol-photo-section').classList.contains('hidden') === false;
            if (isBOL && !photoUploaded) {
                showMessage('complete', 'üì∏ Photo required for BOL checks!', 'error');
                return;
            }

            const data = {
                inspectionId: currentInspectionId,
                result: inspectionResult,
                defectsCount: defects.length,
                defects: defects,
                otherNotes: document.getElementById('complete-notes').value
            };

            try {
                const response = await fetch(SHEET_URL + '?action=completeInspection', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (result.error) {
                    throw new Error(result.error);
                }

                showMessage('complete', `‚úÖ Inspection completed! Duration: ${result.duration} minutes`, 'success');
                
                // Reset
                setTimeout(() => {
                    currentInspectionId = null;
                    inspectionResult = null;
                    defects = [];
                    photoUploaded = false;
                    document.getElementById('complete-inspection-id').value = '';
                    document.getElementById('inspection-details').classList.remove('visible');
                    loadInspectionsForCompletion();
                }, 2000);

            } catch (error) {
                console.error('Error completing inspection:', error);
                showMessage('complete', 'Error completing inspection: ' + error.message, 'error');
            }
        }

        // Search archive
        async function searchArchive() {
            const query = document.getElementById('archive-search').value;
            const type = document.getElementById('archive-type').value;
            const client = document.getElementById('archive-client').value;

            try {
                const params = new URLSearchParams();
                if (query) params.append('query', query);
                if (type) params.append('type', type);
                if (client) params.append('client', client);

                const response = await fetch(SHEET_URL + '?action=searchArchive&' + params.toString());
                const data = await response.json();

                const tbody = document.querySelector('#archive-table tbody');
                tbody.innerHTML = '';

                if (data.results.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #718096;">No archived inspections found</td></tr>';
                    return;
                }

                data.results.forEach(result => {
                    const row = tbody.insertRow();
                    const statusClass = result.Result === 'Pass' ? 'status-pass' : result.Result === 'Fail' ? 'status-fail' : 'status-rework';
                    row.innerHTML = `
                        <td>${result['Created Date']}</td>
                        <td>${result['Inspection Type']}</td>
                        <td>${result['Order/WO Number']}</td>
                        <td>${result.Client}</td>
                        <td>${result.Inspector}</td>
                        <td><span class="status-badge ${statusClass}">${result.Result}</span></td>
                        <td>${result['Duration (minutes)']} min</td>
                    `;
                });

            } catch (error) {
                console.error('Error searching archive:', error);
                showMessage('archive', 'Error searching archive', 'error');
            }
        }

        // Archive completed inspections
        async function archiveCompleted() {
            if (!confirm('Archive all completed inspections older than 30 days?')) {
                return;
            }

            try {
                const response = await fetch(SHEET_URL + '?action=archiveCompleted', {
                    method: 'POST',
                    body: '{}'
                });
                const result = await response.json();

                showMessage('archive', `‚úÖ Archived ${result.archivedCount} inspections`, 'success');

            } catch (error) {
                console.error('Error archiving:', error);
                showMessage('archive', 'Error archiving inspections', 'error');
            }
        }

        // Helper: Show message
        function showMessage(tab, message, type) {
            const messageDiv = document.getElementById(tab + '-message') || document.getElementById(tab);
            if (messageDiv) {
                messageDiv.innerHTML = `<div class="message message-${type}">${message}</div>`;
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                }, 5000);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            loadClients();
        });
    </script>
</body>
</html>
